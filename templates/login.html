{% extends "base.html" %}
{% load static %}
{% block title %}login{% endblock title %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'assets/css/login.css'%}">
{% endblock extra_css %}

{% block content %}

<script>
    // Handle form submission
    document.addEventListener('DOMContentLoaded', function() {
        const loginForm = document.getElementById('loginForm');
        
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault(); // Stop default form submission
            
            // Get the form data
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
            
            // Create FormData object
            const formData = new FormData();
            formData.append('email', email);
            formData.append('password', password);
            formData.append('csrfmiddlewaretoken', csrfToken);
            
            // Send the data via POST request
            fetch('/login/', {
                method: 'POST',
                body: formData,
                headers: {
                    // Good practice for Django to know it's an AJAX request
                    'X-Requested-With': 'XMLHttpRequest' 
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'Error') {
                    alert("Error:" + data.message);
                } else {
                    window.location.href = data.redirect_url; 
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred. Please try again.');
            });
        });
    });
</script>

     <section class="login-section">
        <div class="container d-flex justify-content-center">
            <div class="login-container">
                <div class="login-header">
                    <i class="fas fa-shield-alt"></i>
                    <h2>Welcome Back</h2>
                    <p>Sign in to your Clause Guard account</p>
                </div>
                
                <form id="loginForm">
                     {% csrf_token %}
                    <div class="form-group">
                        <label for="email" class="form-label">Email Address</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                            <input type="email" class="form-control" id="email" placeholder="Enter your email" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="password" class="form-label">Password</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-lock"></i></span>
                            <input type="password" class="form-control" id="password" placeholder="Enter your password" required>
                        </div>
                    </div>
                    
                    <div class="role-buttons">
                        <button type="submit" class="btn btn-primary" id="adminBtn">
                            <i class="fas fa-user-shield me-2"></i> Login
                        </button>
                        {% comment %} <button type="button" class="btn btn-outline-primary" id="userBtn">
                            <i class="fas fa-user me-2"></i> User
                        </button> {% endcomment %}
                    </div>
                </form>
             
            </div>
        </div>
    </section>
{% endblock content %}